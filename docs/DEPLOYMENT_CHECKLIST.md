# Ubuntu 22.04 服务器部署检查清单

> 使用此检查清单确保服务器配置和部署的每个步骤都已完成。

---

## 📋 部署前准备

### 服务器采购
- [ ] 购买云服务器（推荐配置: 2核4G40GB SSD）
- [ ] 选择 Ubuntu 22.04 LTS 系统
- [ ] 配置安全组（开放 SSH、HTTP、HTTPS 端口）
- [ ] 获取服务器 IP 地址和 root 密码

### 本地准备
- [ ] 安装 Git 客户端
- [ ] 生成 SSH 密钥对
- [ ] 准备域名（如需要）
- [ ] 配置 DNS 解析（如需要）
- [ ] 准备 HeartSync 代码

---

## 🖥️ 服务器初始化

### 基础配置
- [ ] 连接到服务器（SSH）
- [ ] 更新系统包（apt update & upgrade）
- [ ] 设置主机名
- [ ] 设置时区（推荐 Asia/Shanghai）
- [ ] 配置 NTP 时间同步
- [ ] 安装基础工具（curl, wget, git, vim 等）

### 用户和权限
- [ ] 创建 deploy 用户
- [ ] 配置 sudo 权限
- [ ] 生成 SSH 密钥对
- [ ] 复制公钥到本地电脑
- [ ] 测试 SSH 免密登录

### 安全配置
- [ ] 修改 SSH 端口（推荐 2222）
- [ ] 禁用 root SSH 登录
- [ ] 禁用 SSH 密码认证
- [ ] 配置 SSH 密钥认证
- [ ] 重启 SSH 服务
- [ ] 测试新端口连接

### 防火墙配置
- [ ] 安装 UFW 防火墙
- [ ] 配置默认策略（拒绝入站，允许出站）
- [ ] 允许 SSH 端口（2222）
- [ ] 允许 HTTP 端口（80）
- [ ] 允许 HTTPS 端口（443）
- [ ] 启用防火墙
- [ ] 验证防火墙状态

### 入侵防护
- [ ] 安装 Fail2ban
- [ ] 配置 SSH 监控
- [ ] 配置 Nginx 监控
- [ ] 设置封禁策略
- [ ] 启动 Fail2ban
- [ ] 验证 Fail2ban 状态

### 系统安全加固
- [ ] 配置 sysctl 安全参数
- [ ] 配置文件描述符限制
- [ ] 配置 ulimit
- [ ] 应用系统配置
- [ ] 验证配置生效

### 自动安全更新
- [ ] 安装 unattended-upgrades
- [ ] 配置自动更新策略
- [ ] 测试自动更新
- [ ] 验证定时任务

---

## 🛠️ 基础服务安装

### Python 环境
- [ ] 安装 Python 3
- [ ] 安装 pip
- [ ] 安装 Python 开发库
- [ ] 升级 pip 到最新版本
- [ ] 验证 Python 版本

### 数据库安装
- [ ] 安装 PostgreSQL
- [ ] 启动 PostgreSQL 服务
- [ ] 创建数据库用户（heart_sync）
- [ ] 创建数据库（heart_sync）
- [ ] 配置数据库权限
- [ ] 测试数据库连接

### Nginx 安装
- [ ] 安装 Nginx
- [ ] 启动 Nginx 服务
- [ ] 测试 Nginx 服务
- [ ] 访问默认页面

### 监控工具
- [ ] 安装 htop
- [ ] 安装 iotop
- [ ] 安装 nethogs
- [ ] 安装 sysstat
- [ ] 配置 sysstat
- [ ] 启动 sysstat

---

## 📁 项目配置

### 目录结构
- [ ] 创建项目目录（/var/www/heart_sync）
- [ ] 创建日志目录（logs）
- [ ] 创建备份目录（backup）
- [ ] 创建静态文件目录（static）
- [ ] 创建模板目录（templates）
- [ ] 创建数据目录（data）
- [ ] 设置目录权限

### 代码部署
- [ ] 克隆代码到服务器
- [ ] 或上传代码到服务器
- [ ] 验证代码完整性
- [ ] 创建 Python 虚拟环境
- [ ] 激活虚拟环境

### 依赖安装
- [ ] 升级 pip
- [ ] 安装 Gunicorn
- [ ] 安装应用依赖（requirements.txt）
- [ ] 验证依赖安装
- [ ] 测试导入关键模块

### 环境配置
- [ ] 复制环境配置模板
- [ ] 编辑环境配置文件
- [ ] 配置 SECRET_KEY
- [ ] 配置数据库 URL
- [ ] 配置 CORS 设置
- [ ] 配置日志设置

---

## 🗄️ 数据库配置

### SQLite（开发环境）
- [ ] 创建数据库文件
- [ ] 设置数据库权限
- [ ] 初始化数据库表
- [ ] 测试数据库连接

### PostgreSQL（生产环境）
- [ ] 配置 PostgreSQL 连接
- [ ] 创建数据库用户
- [ ] 创建数据库
- [ ] 配置数据库权限
- [ ] 测试数据库连接
- [ ] 初始化数据库表

---

## 🌐 Web 服务器配置

### Nginx 基础配置
- [ ] 创建站点配置文件
- [ ] 配置服务器名称
- [ ] 配置反向代理
- [ ] 配置静态文件
- [ ] 配置 WebSocket 支持
- [ ] 配置健康检查

### SSL 证书
- [ ] 安装 Certbot
- [ ] 获取 SSL 证书
- [ ] 配置 Nginx SSL
- [ ] 配置 HTTP 到 HTTPS 重定向
- [ ] 测试 HTTPS 访问
- [ ] 验证证书有效期
- [ ] 配置证书自动续期

### Nginx 优化
- [ ] 配置 Gzip 压缩
- [ ] 配置缓存头部
- [ ] 配置安全头部
- [ ] 配置超时设置
- [ ] 配置客户端上传大小
- [ ] 测试 Nginx 配置

---

## 🐍 应用部署

### 应用服务配置
- [ ] 创建 systemd 服务文件
- [ ] 配置 Gunicorn 参数
- [ ] 配置工作进程数
- [ ] 配置超时设置
- [ ] 配置日志输出
- [ ] 配置自动重启

### 应用启动
- [ ] 重载 systemd
- [ ] 启用服务（开机自启）
- [ ] 启动服务
- [ ] 验证服务状态
- [ ] 查看服务日志

### 健康检查
- [ ] 测试本地健康检查（curl localhost:5000/health）
- [ ] 测试外部访问（curl http://yourdomain.com/health）
- [ ] 测试 WebSocket 连接
- [ ] 测试数据库连接
- [ ] 验证所有端点

---

## 📊 监控和日志

### 日志配置
- [ ] 配置应用日志
- [ ] 配置 Nginx 日志
- [ ] 配置日志轮转
- [ ] 测试日志轮转
- [ ] 验证日志写入

### 监控脚本
- [ ] 配置健康检查脚本
- [ ] 配置系统监控脚本
- [ ] 添加到定时任务
- [ ] 测试监控脚本
- [ ] 验证定时任务

### 备份配置
- [ ] 配置数据库备份脚本
- [ ] 配置应用备份脚本
- [ ] 配置备份目录
- [ ] 添加到定时任务
- [ ] 测试备份脚本
- [ ] 验证备份文件
- [ ] 配置备份保留策略

---

## ✅ 验证测试

### 功能测试
- [ ] 访问应用主页
- [ ] 测试用户注册
- [ ] 测试用户登录
- [ ] 测试用户登出
- [ ] 测试房间创建
- [ ] 测试实时通信
- [ ] 测试配对功能
- [ ] 测试文件上传（如适用）

### 性能测试
- [ ] 进行压力测试（ab）
- [ ] 检查响应时间
- [ ] 检查并发处理
- [ ] 检查资源使用
- [ ] 优化性能瓶颈

### 安全测试
- [ ] 检查 SSL 配置
- [ ] 检查安全头部
- [ ] 检查 HTTPS 重定向
- [ ] 检查防火墙规则
- [ ] 检查 Fail2ban 状态
- [ ] 检查端口扫描

---

## 📖 文档和记录

### 文档准备
- [ ] 记录服务器信息（IP、端口、密码）
- [ ] 记录应用配置信息
- [ ] 记录数据库信息
- [ ] 记录管理员账号
- [ ] 备份配置文件

### 运维文档
- [ ] 编写部署文档
- [ ] 编写运维手册
- [ ] 编写故障排除指南
- [ ] 记录常用命令
- [ ] 更新知识库

---

## 🔒 安全审计

### 系统安全
- [ ] 检查系统更新
- [ ] 检查安全公告
- [ ] 检查开放端口
- [ ] 检查用户权限
- [ ] 检查定时任务
- [ ] 检查服务配置

### 应用安全
- [ ] 检查环境变量（不包含敏感信息）
- [ ] 检查日志（不包含敏感信息）
- [ ] 检查错误处理
- [ ] 检查输入验证
- [ ] 检查权限控制

---

## 🚀 部署完成

### 最终验证
- [ ] 所有服务正常运行
- [ ] 应用功能正常
- [ ] 日志正常记录
- [ ] 备份正常执行
- [ ] 监控正常工作
- [ ] SSL 证书有效

### 交付准备
- [ ] 准备交付文档
- [ ] 准备管理员账号
- [ ] 准备访问信息
- [ ] 准备联系方式
- [ ] 准备应急方案

---

## 📋 日常运维检查清单

### 每日检查
- [ ] 检查系统负载
- [ ] 检查磁盘使用
- [ ] 检查内存使用
- [ ] 查看错误日志
- [ ] 检查服务状态

### 每周检查
- [ ] 检查备份完整性
- [ ] 检查 SSL 证书有效期
- [ ] 审查安全日志
- [ ] 分析性能指标
- [ ] 更新系统补丁

### 每月检查
- [ ] 全面系统审计
- [ ] 测试备份恢复
- [ ] 性能优化评估
- [ ] 容量规划
- [ ] 文档更新

---

## 🆘 应急响应检查清单

### 应用故障
- [ ] 检查服务状态
- [ ] 查看错误日志
- [ ] 尝试重启服务
- [ ] 如失败，准备回滚
- [ ] 执行回滚（如需要）
- [ ] 验证服务恢复

### 数据库故障
- [ ] 检查数据库服务
- [ ] 检查连接性
- [ ] 尝试重启服务
- [ ] 如损坏，准备恢复
- [ ] 执行备份恢复
- [ ] 验证数据完整性

### 安全事件
- [ ] 立即隔离受影响系统
- [ ] 检查访问日志
- [ ] 封锁可疑 IP
- [ ] 更新安全策略
- [ ] 系统安全扫描
- [ ] 修补安全漏洞

---

## 📞 联系信息

### 技术支持
- [ ] 记录技术支持联系方式
- [ ] 记录供应商支持信息
- [ ] 记录云服务商联系方式

### 应急联系
- [ ] 记录管理员联系方式
- [ ] 记录负责人联系方式
- [ ] 记录运维团队联系方式

---

**部署日期**: _______________
**部署人员**: _______________
**审核人员**: _______________
**备注**: _______________

---

## 使用说明

1. 在每个阶段完成后，勾选相应的复选框
2. 如果某项不适用，可以标记为 "N/A"
3. 完成所有检查后，可以确认部署成功
4. 定期使用运维检查清单进行系统维护

祝你部署顺利！🚀
